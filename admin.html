<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Maus-City Store â€“ Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    .section {
      background: white;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 30px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    input, textarea {
      padding: 6px;
      margin: 4px 0;
      width: 100%;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    button {
      background: #007aff;
      color: white;
      border: none;
      padding: 8px 14px;
      margin-top: 8px;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover {
      background: #005bb5;
    }
    .delete-btn {
      background: red;
      margin-left: 10px;
    }
    .produkt-box {
      margin-bottom: 16px;
      padding-bottom: 8px;
      border-bottom: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <h1>Admin â€“ Maus-City Store</h1>

  <div class="section">
    <h2>ðŸ›’ Bestellungen</h2>
    <div id="bestellungen"></div>
  </div>

  <div class="section">
    <h2>ðŸ“¦ Produkte verwalten</h2>
    <input id="pname" placeholder="Produktname">
    <input id="ppreis" type="number" placeholder="Preis (Maus-Dollar)">
    <input id="plieferzeit" placeholder="Lieferzeit z.â€¯B. 2â€“3 Tage">
    <input id="pstock" type="number" placeholder="Lagerbestand">
    <textarea id="pbeschreibung" placeholder="Beschreibung" rows="3"></textarea>
    <button onclick="speichern()">Speichern</button>

    <div id="produktliste"></div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js";
    import { getDatabase, ref, set, remove, onValue } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-database.js";

    const app = initializeApp({
      apiKey: "AIzaSyAQaNKUa-RKvUcwlPpWnEyKxcVjYV6cZuU",
      authDomain: "gesamt-dae4e.firebaseapp.com",
      databaseURL: "https://gesamt-dae4e-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "gesamt-dae4e",
      storageBucket: "gesamt-dae4e.appspot.com",
      messagingSenderId: "844023612743",
      appId: "1:844023612743:web:0821aa894541f89a7df862"
    });

    const db = getDatabase(app);

    const pname = document.getElementById("pname");
    const ppreis = document.getElementById("ppreis");
    const plieferzeit = document.getElementById("plieferzeit");
    const pstock = document.getElementById("pstock");
    const pbeschreibung = document.getElementById("pbeschreibung");
    const produktliste = document.getElementById("produktliste");
    let editId = null;

    function speichern() {
      const name = pname.value.trim();
      const preis = parseInt(ppreis.value);
      const lieferzeit = plieferzeit.value.trim();
      const stock = parseInt(pstock.value);
      const beschreibung = pbeschreibung.value.trim();
      if (!name || !lieferzeit || isNaN(preis) || isNaN(stock)) {
        alert("Bitte alle Felder korrekt ausfÃ¼llen.");
        return;
      }

      const id = editId || Date.now().toString();
      set(ref(db, "shopartikel/" + id), { name, preis, lieferzeit, stock, beschreibung });
      pname.value = "";
      ppreis.value = "";
      plieferzeit.value = "";
      pstock.value = "";
      pbeschreibung.value = "";
      editId = null;
    }

    onValue(ref(db, "shopartikel"), (snapshot) => {
      produktliste.innerHTML = "";
      snapshot.forEach(child => {
        const id = child.key;
        const data = child.val();
        const div = document.createElement("div");
        div.className = "produkt-box";
        div.innerHTML = `
          <b>${data.name}</b> â€“ ${data.preis} MD â€“ Lager: ${data.stock} â€“ ${data.lieferzeit}<br>
          <i>${data.beschreibung || "Keine Beschreibung"}</i><br>
          <button onclick="bearbeiten('${id}', ${JSON.stringify(data).replace(/"/g, '&quot;')})">Bearbeiten</button>
          <button class="delete-btn" onclick="entfernen('${id}')">LÃ¶schen</button>
        `;
        produktliste.appendChild(div);
      });
    });

    window.entfernen = (id) => {
      if (confirm("Wirklich lÃ¶schen?")) {
        remove(ref(db, "shopartikel/" + id));
      }
    };

    window.bearbeiten = (id, data) => {
      editId = id;
      pname.value = data.name;
      ppreis.value = data.preis;
      plieferzeit.value = data.lieferzeit;
      pstock.value = data.stock;
      pbeschreibung.value = data.beschreibung || "";
      window.scrollTo(0, 0);
    };

    onValue(ref(db, "bestellungen"), (snapshot) => {
      const el = document.getElementById("bestellungen");
      el.innerHTML = "";
      snapshot.forEach(child => {
        const id = child.key;
        const data = child.val();
        const box = document.createElement("div");
        box.innerHTML = `ðŸ§’ ${data.name} hat <b>${data.produkt}</b> bestellt<br>
        <button onclick="remove(ref(db, 'bestellungen/${id}'))">x</button><br><br>`;
        el.appendChild(box);
      });
    });
  </script>
</body>
</html>
