<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Maus-City Adminbereich</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f0f0f0;
      padding: 16px;
    }
    h2 {
      margin-top: 20px;
      font-size: 18px;
    }
    .section {
      background: white;
      padding: 16px;
      margin-top: 10px;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    .item span {
      flex: 1;
    }
    .item button {
      margin-left: 6px;
      background: #d33;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 4px 8px;
      cursor: pointer;
    }
    .item button.edit {
      background: #ffa500;
    }
    input, textarea {
      width: 100%;
      margin: 4px 0 10px;
      padding: 6px;
      box-sizing: border-box;
    }
    button.add {
      background: #28a745;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 5px;
      cursor: pointer;
      width: 100%;
    }
  </style>
</head>
<body>

  <h1>Maus-City Adminbereich</h1>

  <h2>üõí Bestellungen</h2>
  <div class="section" id="ordersSection"></div>

  <h2>üß∞ Produktverwaltung</h2>
  <div class="section">
    <input type="text" id="name" placeholder="Produktname">
    <input type="number" id="preis" placeholder="Preis (Maus$)">
    <input type="text" id="lieferzeit" placeholder="Lieferzeit (z.‚ÄØB. 1‚Äì2 Tage)">
    <textarea id="beschreibung" placeholder="Beschreibung (optional)"></textarea>
    <button class="add" onclick="addProduct()">Produkt hinzuf√ºgen</button>
  </div>

  <div class="section" id="productList"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import {
      getDatabase, ref, onValue, set, remove, push, update
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const app = initializeApp({
      databaseURL: "https://punkte-45c20-default-rtdb.europe-west1.firebasedatabase.app"
    });

    const db = getDatabase(app);

    const ordersSection = document.getElementById("ordersSection");
    const productList = document.getElementById("productList");

    const nameInput = document.getElementById("name");
    const preisInput = document.getElementById("preis");
    const lieferInput = document.getElementById("lieferzeit");
    const beschrInput = document.getElementById("beschreibung");

    function renderOrders() {
      const bestellRef = ref(db, "bestellungen");
      onValue(bestellRef, snapshot => {
        ordersSection.innerHTML = "";
        const orders = snapshot.val() || {};
        Object.entries(orders).forEach(([id, data]) => {
          const div = document.createElement("div");
          div.className = "item";
          div.innerHTML = `<span>üì¶ ${data.name} bestellt ${data.artikel} (${data.lieferzeit || "-"})</span>
                           <button onclick="deleteOrder('${id}')">x</button>`;
          ordersSection.appendChild(div);
        });
      });
    }

    function deleteOrder(id) {
      const refPath = ref(db, `bestellungen/${id}`);
      remove(refPath);
    }

    function renderProducts() {
      const prodRef = ref(db, "shopartikel");
      onValue(prodRef, snapshot => {
        productList.innerHTML = "";
        const products = snapshot.val() || {};
        Object.entries(products).forEach(([id, data]) => {
          const div = document.createElement("div");
          div.className = "item";
          div.innerHTML = `<span>üß∏ ${data.name} ‚Äì ${data.preis} Maus$ (${data.lieferzeit || "-"})</span>
            <button class="edit" onclick="editProduct('${id}', ${JSON.stringify(data).replace(/"/g, '&quot;')})">‚úèÔ∏è</button>
            <button onclick="deleteProduct('${id}')">x</button>`;
          productList.appendChild(div);
        });
      });
    }

    function deleteProduct(id) {
      const refPath = ref(db, `shopartikel/${id}`);
      remove(refPath);
    }

    function addProduct() {
      const name = nameInput.value.trim();
      const preis = parseInt(preisInput.value.trim());
      const lieferzeit = lieferInput.value.trim();
      const beschreibung = beschrInput.value.trim();

      if (!name || isNaN(preis)) return;

      const newRef = push(ref(db, "shopartikel"));
      set(newRef, { name, preis, lieferzeit, beschreibung });

      nameInput.value = "";
      preisInput.value = "";
      lieferInput.value = "";
      beschrInput.value = "";
    }

    window.editProduct = function (id, data) {
      nameInput.value = data.name;
      preisInput.value = data.preis;
      lieferInput.value = data.lieferzeit || "";
      beschrInput.value = data.beschreibung || "";

      const button = document.querySelector("button.add");
      button.textContent = "√Ñnderung speichern";
      button.onclick = function () {
        const updated = {
          name: nameInput.value.trim(),
          preis: parseInt(preisInput.value.trim()),
          lieferzeit: lieferInput.value.trim(),
          beschreibung: beschrInput.value.trim()
        };
        update(ref(db, `shopartikel/${id}`), updated);

        nameInput.value = "";
        preisInput.value = "";
        lieferInput.value = "";
        beschrInput.value = "";

        button.textContent = "Produkt hinzuf√ºgen";
        button.onclick = addProduct;
      };
    };

    renderOrders();
    renderProducts();
  </script>
</body>
</html>